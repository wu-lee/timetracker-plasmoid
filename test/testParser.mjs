// -*- javascript -*-
import Parser from '../package/contents/ui/parseTasks.mjs';
import fs from 'fs';


const data = fs.readFileSync('/home/nick/tasks.log').toString();

//console.log(data);
//console.log(Parser.parseTasks(data))



const testCases = [
    {name: 'empty',
     log: '',
     expect: {}},
    {name: 'empty',
     log: '1\tinit\t\t100\t',
     expect: {}},

    {name: 'real',
     log: `1	init		2021-09-01T21:09:14.858Z
1	switch	2021-09-01T21:09:14.858Z	2021-09-01T21:16:16.008Z	ICA data update
1	start	2021-09-01T21:16:16.008Z	2021-09-01T21:16:16.016Z	
1	mark	2021-09-01T21:16:16.016Z	2021-09-01T21:17:13.285Z	
1	mark	2021-09-01T21:17:13.285Z	2021-09-01T21:18:10.507Z	
1	mark	2021-09-01T21:18:10.507Z	2021-09-01T21:19:07.582Z	
1	mark	2021-09-01T21:19:07.582Z	2021-09-01T21:20:04.926Z	
1	mark	2021-09-01T21:20:04.926Z	2021-09-01T21:21:02.230Z	
1	mark	2021-09-01T21:21:02.230Z	2021-09-01T21:21:59.592Z	
1	mark	2021-09-01T21:21:59.592Z	2021-09-01T21:22:56.936Z	
1	mark	2021-09-01T21:22:56.936Z	2021-09-01T21:23:54.279Z	
1	mark	2021-09-01T21:23:54.279Z	2021-09-01T21:24:51.621Z	
1	mark	2021-09-01T21:24:51.621Z	2021-09-01T21:25:48.958Z	
1	mark	2021-09-01T21:25:48.958Z	2021-09-01T21:26:46.300Z	
1	mark	2021-09-01T21:26:46.300Z	2021-09-01T21:27:43.646Z	
1	mark	2021-09-01T21:27:43.646Z	2021-09-01T21:28:40.966Z	
1	mark	2021-09-01T21:28:40.966Z	2021-09-01T21:29:38.308Z	
1	mark	2021-09-01T21:29:38.308Z	2021-09-01T21:30:35.646Z	
1	mark	2021-09-01T21:30:35.646Z	2021-09-01T21:31:32.692Z	
1	mark	2021-09-01T21:31:32.692Z	2021-09-01T21:32:30.033Z	
1	mark	2021-09-01T21:32:30.033Z	2021-09-01T21:33:27.357Z	
1	mark	2021-09-01T21:33:27.357Z	2021-09-01T21:34:24.539Z	
1	mark	2021-09-01T21:34:24.539Z	2021-09-01T21:35:21.887Z	
1	mark	2021-09-01T21:35:21.887Z	2021-09-01T21:36:19.229Z	
1	mark	2021-09-01T21:36:19.229Z	2021-09-01T21:37:16.568Z	
1	mark	2021-09-01T21:37:16.568Z	2021-09-01T21:38:13.906Z	
1	mark	2021-09-01T21:38:13.906Z	2021-09-01T21:39:11.248Z	
1	mark	2021-09-01T21:39:11.248Z	2021-09-01T21:40:08.439Z	
1	stop	2021-09-01T21:40:08.439Z	2021-09-01T21:40:12.619Z	
1	start	2021-09-01T21:40:12.619Z	2021-09-01T21:45:40.032Z	
1	stop	2021-09-01T21:45:40.032Z	2021-09-01T21:45:41.707Z
1	init		2021-09-01T21:47:41.740Z
1	switch	2021-09-01T21:47:41.740Z	2021-09-01T21:49:17.236Z	ICA data update
1	start	2021-09-01T21:49:17.236Z	2021-09-01T21:49:17.245Z	
1	stop	2021-09-01T21:49:17.245Z	2021-09-01T21:49:19.283Z	
1	start	2021-09-01T21:49:19.283Z	2021-09-01T21:49:22.231Z	
1	stop	2021-09-01T21:49:22.231Z	2021-09-01T21:49:24.046Z	
1	init		2021-09-01T21:55:31.912Z
1	init		2021-09-01T21:57:36.167Z
1	init		2021-09-01T21:58:03.365Z
     `,
     expect: { 'ICA data update': 1442 },
    }
]

testCases.forEach((c) => {
            const output = Parser.parseTasks(c.log, Parser.mkTaskListAccumulator())
    if (JSON.stringify(output) !== JSON.stringify(c.expect))
        console.log(c.name,": failed", output);
    else
        console.log(c.name,": passed");
})
